SELECT 
YEAR
,MONTH
,GENDER
,COUNT(*) AS USERS
FROM(
SELECT 
    B.USER_ID AS USER_ID
    , TO_CHAR(SALES_DATE,'YYYY') AS YEAR
    , TO_NUMBER(TO_CHAR(SALES_DATE,'MM')) AS MONTH
    , GENDER AS GENDER
FROM USER_INFO A
, ONLINE_SALE B
WHERE A.USER_ID = B.USER_ID
AND A.GENDER IS NOT NULL
GROUP BY B.USER_ID, TO_CHAR(SALES_DATE,'YYYY'), TO_CHAR(SALES_DATE,'MM'), GENDER
)
GROUP BY YEAR,MONTH,GENDER
ORDER BY YEAR, MONTH, GENDER ASC
